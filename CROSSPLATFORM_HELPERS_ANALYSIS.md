# Cross-Platform Helper Files - Analysis & Cleanup

## Summary

Cleaned up non-standard crossplatform helper files to follow the Rust pattern established by the code generator.

## The Correct Pattern (Rust Standard)

Each schema has its own generated helper in the language-specific directory:

```
testdata/<schema>/<language>/examples/crossplatform_helper.<ext>
```

**Examples:**
- `testdata/primitives/rust/examples/crossplatform_helper.rs` ✅
- `testdata/primitives/swift/Sources/crossplatform_helper/main.swift` ✅
- `testdata/arrays/rust/examples/crossplatform_helper.rs` ✅
- `testdata/optional/rust/examples/crossplatform_helper.rs` ✅

**Key Characteristics:**
1. **Generated:** Created by `internal/generator/<lang>/example_gen.go`
2. **Integrated:** Part of Cargo.toml (Rust) or Package.swift (Swift)
3. **Per-Schema:** One helper per schema, not shared
4. **Build System:** Uses standard language build tools
   - Rust: `cargo run --release --example crossplatform_helper`
   - Swift: `swift run -c release crossplatform_helper`

## Files Removed (Commit 77cc89c)

### 1. `testdata/crossplatform_helper.go` ❌
**Why removed:**
- Standalone Go file, not generated
- Hardcoded for primitives only
- Go doesn't need cross-platform helpers (uses direct Go testing in crossplatform_test.go)

### 2. `testdata/swift_crossplatform_helper.swift` ❌
**Why removed:**
- Standalone Swift script with all code inlined
- Not generated by code generator
- Duplicate of proper generated version in `testdata/primitives/swift/`

### 3. `testdata/swift_crossplatform_helper/` directory ❌
**Why removed:**
- Experimental standalone Swift package
- Has its own Package.swift and .build artifacts
- Not part of the generated structure
- **Note:** VS Code's Swift extension may try to recreate a `.build` directory here if old references exist in documentation. All such references have been cleaned up and the file `SWIFT_CROSSPLATFORM_TESTS.md` has been archived.

## How Cross-Platform Testing Works

### Rust (Established)
```rust
// Generated in testdata/<schema>/rust/examples/crossplatform_helper.rs
fn encode_all_primitives() -> StdResult<()> {
    let data = AllPrimitives { ... };
    let mut buf = vec![0u8; data.encoded_size()];
    data.encode_to_slice(&mut buf)?;
    io::stdout().write_all(&buf)?;
    Ok(())
}
```

### Swift (Step 15 - Following Rust)
```swift
// Generated in testdata/<schema>/swift/Sources/crossplatform_helper/main.swift
func encodeAllPrimitives() throws {
    let data = AllPrimitives(...)
    let bytes = data.encodeToBytes()
    let binaryData = Data(bytes)
    FileHandle.standardOutput.write(binaryData)
}
```

### Go (Different Approach)
Go doesn't use generated helpers. Instead:
- `crossplatform_test.go` directly imports generated Go packages
- Tests encode/decode directly in Go
- No need for external CLI helper

## Generator Implementation

### Rust: `internal/generator/rust/example_gen.go`
```go
func GenerateExample(schema *parser.Schema, packageName string) string {
    // Generates crossplatform_helper.rs with encode/decode functions
    // Outputs to examples/ directory
    // Integrated into Cargo.toml as [[example]]
}
```

### Swift: `internal/generator/swift/example_gen.go` (Step 15)
```go
func GenerateExample(schema *parser.Schema, packageName string) string {
    // Generates main.swift with encode/decode functions
    // Outputs to Sources/crossplatform_helper/ directory
    // Integrated into Package.swift as .executableTarget
}
```

## File Structure After Cleanup

```
testdata/
├── primitives/
│   ├── rust/
│   │   ├── src/lib.rs
│   │   ├── examples/
│   │   │   └── crossplatform_helper.rs  ✅ Generated
│   │   └── Cargo.toml
│   ├── swift/
│   │   ├── Sources/
│   │   │   ├── swift/              (library)
│   │   │   └── crossplatform_helper/
│   │   │       └── main.swift      ✅ Generated
│   │   └── Package.swift
│   └── go/
│       └── *.go                     (no helper needed)
├── arrays/
│   ├── rust/examples/crossplatform_helper.rs  ✅
│   └── swift/Sources/crossplatform_helper/main.swift  ✅
└── ...
```

## Testing Commands

**Rust (working):**
```bash
cd testdata/primitives/rust
cargo run --release --example crossplatform_helper encode-all_primitives > /tmp/rust.bin
cargo run --release --example crossplatform_helper decode-all_primitives /tmp/rust.bin
```

**Swift (working after step 15):**
```bash
cd testdata/primitives/swift
swift run -c release crossplatform_helper encode-AllPrimitives > /tmp/swift.bin
swift run -c release crossplatform_helper decode-AllPrimitives /tmp/swift.bin
```

**Cross-language verification:**
```bash
# Encode with Rust, decode with Swift
cd testdata/primitives/rust
cargo run --release --example crossplatform_helper encode-all_primitives > /tmp/test.bin
cd ../swift
swift run -c release crossplatform_helper decode-AllPrimitives /tmp/test.bin
# Output: ✓ Swift successfully decoded and validated
```

## Next Steps (Step 16)

Enable Swift in TestMain to:
1. Generate Swift code for all 6 schemas (primitives, arrays, optional, complex, audiounit, nested)
2. Build all Swift packages with optimization flags
3. Verify all crossplatform_helper executables work
4. Update crossplatform_test.go to include Swift in cross-language tests

## References

- Commit 66a2465: feat(swift): Add example helper generation (step 15)
- Commit 77cc89c: chore: Remove non-standard crossplatform helper files
- Rust standard: `internal/generator/rust/example_gen.go`
- Swift implementation: `internal/generator/swift/example_gen.go`
