# Objective-C++ Example Project

This example demonstrates how to use SDP from Objective-C++ in a real macOS/iOS application.

## Project Structure

```
objcpp-example/
├── README.md                 (this file)
├── schema/
│   └── user.sdp             (Example schema)
├── Generated/                (Generated by sdp-gen)
│   ├── types.hpp
│   ├── encode.hpp
│   └── decode.hpp
├── Source/
│   ├── SDPSerializer.h      (Objective-C interface)
│   ├── SDPSerializer.mm     (C++ bridge implementation)
│   ├── User.h               (Model class)
│   └── User.m               (Model implementation)
└── Tests/
    └── SDPSerializerTests.mm (Unit tests)
```

## Setup Instructions

### 1. Generate Code

```bash
cd objcpp-example

# Generate C++ code from schema
sdp-gen --schema schema/user.sdp --output Generated --lang cpp
```

This will create:
- `Generated/types.hpp` - User struct definition
- `Generated/encode.hpp` - EncodeUser function
- `Generated/decode.hpp` - DecodeUser function

### 2. Build (Command Line)

```bash
# Compile the example
clang++ -std=c++17 -ObjC++ -framework Foundation \
    -I Generated \
    -I ../.. \
    Source/SDPSerializer.mm \
    -o test_serializer

# Run
./test_serializer
```

### 3. Build (Xcode)

1. **Open Xcode** and create a new macOS Command Line Tool project
2. **Add Files:**
   - `schema/user.sdp`
   - `Generated/*.hpp` (after running sdp-gen)
   - `Source/*.h` and `Source/*.mm`
   - `../../objcpp_helpers.hpp`

3. **Configure Build Settings:**
   - C++ Language Dialect: C++17
   - C++ Standard Library: libc++
   - Header Search Paths: Add `$(PROJECT_DIR)/Generated` and `$(PROJECT_DIR)/../..`

4. **Build and Run**

## What This Example Shows

1. **Schema Definition** - Simple user data structure
2. **Code Generation** - Using sdp-gen to create C++ code
3. **Objective-C Interface** - Clean API for Objective-C code
4. **C++ Bridge** - Type conversions between Objective-C and C++
5. **Helper Functions** - Using objcpp_helpers.hpp for cleaner code
6. **Unit Tests** - Testing encode/decode roundtrip
7. **Error Handling** - Proper NSError usage
8. **Performance** - Measuring serialization speed

## Key Files

### schema/user.sdp

The schema definition showing a realistic data structure with:
- Primitive types (u32, u8)
- Strings
- Arrays
- Optional fields

### Source/SDPSerializer.h

Pure Objective-C interface that can be imported from `.m` files:
- `+encodeUser:error:` - Serialize User to NSData
- `+decodeUser:error:` - Deserialize NSData to User

### Source/SDPSerializer.mm

The C++ bridge implementation showing:
- Including generated SDP headers
- Converting Objective-C types to C++
- Error handling
- Using helper functions

### Tests/SDPSerializerTests.mm

XCTest unit tests demonstrating:
- Basic encode/decode roundtrip
- Invalid data handling
- Array handling
- Optional field handling
- Performance benchmarks

## Running the Tests

```bash
# Using xcodebuild
xcodebuild test -scheme objcpp-example -destination 'platform=macOS'

# Or open in Xcode and Cmd+U
```

## Performance

Expected performance on M1 Mac:
- Encode: ~10-20μs per user
- Decode: ~15-25μs per user
- Overhead vs pure C++: 5-10%

See the benchmark test for measurements on your hardware.

## Troubleshooting

### "Cannot find 'types.hpp'"
- Run `sdp-gen` to generate the headers first
- Check Header Search Paths in Build Settings

### "Unknown type name 'std::string'"
- Ensure file has `.mm` extension (Objective-C++)
- Add `#include <string>` if needed

### "Linker errors"
- Verify C++ Standard Library is set to libc++
- Check all `.mm` files are in your target

## Next Steps

1. **Modify the schema** - Add your own fields
2. **Add more types** - Create additional structs
3. **Performance testing** - Run benchmarks with your data
4. **Integration** - Copy pattern into your app

## See Also

- `OBJCPP_QUICK_START.md` - Comprehensive usage guide
- `objcpp_helpers.hpp` - Helper function reference
- `DESIGN_SPEC.md` - Wire format specification
- `CPP_IMPLEMENTATION.md` - C++ implementation details
