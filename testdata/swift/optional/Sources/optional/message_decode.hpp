// Auto-generated by sdp-gen. DO NOT EDIT.
// Message mode decoders - self-describing messages with type headers.

#pragma once

#include "types.hpp"
#include "decode.hpp"
#include <cstdint>
#include <vector>
#include <variant>
#include <stdexcept>

namespace sdp {

// Message mode error types
class MessageDecodeError : public std::runtime_error {
public:
    explicit MessageDecodeError(const std::string& msg) : std::runtime_error(msg) {}
};

// DecodeRequestMessage decodes Request from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 1
// Throws MessageDecodeError if header is invalid.
Request DecodeRequestMessage(const std::vector<uint8_t>& data);

// DecodeMetadataMessage decodes Metadata from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 2
// Throws MessageDecodeError if header is invalid.
Metadata DecodeMetadataMessage(const std::vector<uint8_t>& data);

// DecodeConfigMessage decodes Config from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 3
// Throws MessageDecodeError if header is invalid.
Config DecodeConfigMessage(const std::vector<uint8_t>& data);

// DecodeDatabaseConfigMessage decodes DatabaseConfig from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 4
// Throws MessageDecodeError if header is invalid.
DatabaseConfig DecodeDatabaseConfigMessage(const std::vector<uint8_t>& data);

// DecodeCacheConfigMessage decodes CacheConfig from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 5
// Throws MessageDecodeError if header is invalid.
CacheConfig DecodeCacheConfigMessage(const std::vector<uint8_t>& data);

// DecodeDocumentMessage decodes Document from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 6
// Throws MessageDecodeError if header is invalid.
Document DecodeDocumentMessage(const std::vector<uint8_t>& data);

// DecodeTagListMessage decodes TagList from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 7
// Throws MessageDecodeError if header is invalid.
TagList DecodeTagListMessage(const std::vector<uint8_t>& data);

// MessageVariant holds any decoded message type
using MessageVariant = std::variant<
    Request,
    Metadata,
    Config,
    DatabaseConfig,
    CacheConfig,
    Document,
    TagList
>;

// DecodeMessage decodes a message and returns the struct type based on type ID.
// This is the main entry point for decoding self-describing messages.
// Throws MessageDecodeError if header is invalid or type ID is unknown.
MessageVariant DecodeMessage(const std::vector<uint8_t>& data);

} // namespace sdp
