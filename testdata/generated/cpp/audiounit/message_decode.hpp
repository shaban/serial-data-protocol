// Auto-generated by sdp-gen. DO NOT EDIT.
// Message mode decoders - self-describing messages with type headers.

#pragma once

#include "types.hpp"
#include "decode.hpp"
#include <cstdint>
#include <vector>
#include <variant>
#include <stdexcept>

namespace sdp {

// Message mode error types
class MessageDecodeError : public std::runtime_error {
public:
    explicit MessageDecodeError(const std::string& msg) : std::runtime_error(msg) {}
};

// DecodeParameterMessage decodes Parameter from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 1
// Throws MessageDecodeError if header is invalid.
Parameter DecodeParameterMessage(const std::vector<uint8_t>& data);

// DecodePluginMessage decodes Plugin from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 2
// Throws MessageDecodeError if header is invalid.
Plugin DecodePluginMessage(const std::vector<uint8_t>& data);

// DecodePluginRegistryMessage decodes PluginRegistry from self-describing message format.
// Wire format: [SDP:3][version:1][type_id:2][length:4][payload:N]
// Expected Type ID: 3
// Throws MessageDecodeError if header is invalid.
PluginRegistry DecodePluginRegistryMessage(const std::vector<uint8_t>& data);

// MessageVariant holds any decoded message type
using MessageVariant = std::variant<
    Parameter,
    Plugin,
    PluginRegistry
>;

// DecodeMessage decodes a message and returns the struct type based on type ID.
// This is the main entry point for decoding self-describing messages.
// Throws MessageDecodeError if header is invalid or type ID is unknown.
MessageVariant DecodeMessage(const std::vector<uint8_t>& data);

} // namespace sdp
